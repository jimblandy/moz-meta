#!/usr/bin/env bash

set -eux

WGPU=/home/jimb/rust/wgpu

cargo fmt
cargo clippy --workspace -- -D warnings
WGPU_BACKEND=vulkan                             \
    cargo nextest run                           \
    --workspace                                 \
    --exclude cts_runner

# "When RUSTFLAGS is changed between invocations, this can trigger a complete rebuild."
# https://github.com/rust-lang/cargo/issues/8716
# Using a separate target directory avoids affecting other builds.
CARGO_TARGET_DIR=$WGPU/jimb-wasm-target \
    RUSTFLAGS=--cfg=web_sys_unstable_apis \
    cargo clippy \
    --target wasm32-unknown-unknown \
    --features="gles"

cargo doc -p wgpu-core --document-private-items \
      --features="vulkan gles trace replay serial-pass id32 wgsl vulkan-portability" 
#      --all-features
